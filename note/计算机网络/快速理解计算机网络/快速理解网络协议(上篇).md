[快速理解计算机网络上篇]: http://www.52im.net/thread-1095-1-1.html

#### 五层模型

物联网的实现，分成好几层。每一层都有自己的功能，就像建筑物一样，每一层都依靠下一层的支持。用户接触到的，只是最上面的 一层。要理解互联网，必须从最下层开始，自下而上理解每一层的功能。



![](http://www.52im.net/data/attachment/forum/201811/01/150735oly7l6bu5cffff7h.jpg)

如上图所示，最底下的一层叫做“物理层”(Physical Layer)，最上面的一层叫做“应用层”(Application Layre)，中间的三层(自下而上)分别是“链接层”(Link Layer, 又称数据链路层)、“网络层”(Network Layer)和传输层(Transport Layer)。越下面的层越靠近硬件；越上面的层，越靠近用户。

#### 层与协议

每一层都是为了完成一种功能。为了实现这些功能，就需要大家遵守共同的规则大家都遵守的规则，就叫做"协议"(protocol)。

互联网的每一层，都定义了很多协议。这些协议的总称，就叫做“互联网协议”(Internet Protocol Suite)。它们 是互联网的核心。



#### 实体层

电脑要组网，第一件事要干什么？当然是先把电脑连起来，可以用光缆、电缆、双绞线、无线电波等方式。

这就叫做"物理层"，它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。



#### 链接层(数据链路层)

+  **定义**

  单纯的0和1没有任何意义，就必须规定解读方式：多个电信号一组？每个巅信号位有何意义？

  这就是“链接层”的功能，它在“实体层”的上方，确定了0和1的分组方式。

+  **以太网协议**

  早期的时候，每家公司都有自己的电信号分组方式。逐渐地，一种叫做“以太网”(Ethernet)的协议，占据了主导地位。以太网规定，一组电信号构成一个数据包，叫做"帧"(Fame)。每一帧分成两个部分：标头(Head)和数据(Data)。

  ![](http://www.52im.net/data/attachment/forum/201811/01/150929cw8a20dzzlonkene.jpg)

  “标头”包含数据包的一些说明想，比如发送者、接受者、数据类型等等；“数据”则是数据包的具体内容。

  “标头”的长度，固定为18个字节。“数据”的长度，最短为46字节，最长为1500字节。因此，整个“帧”最短为64个字节，最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。

+  **MAC地址**

  上面提到，以太网数据包的"标头"，包含了发送者和接收者的信息。那么，发送者和接受者是如何标识呢？

  以太网规定，连入网络的所有设备，都必须具有“网卡”接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。

  每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48位，通常用12个十六进制表示。

  前6个十六进制是厂商编号，后6个是该厂的网卡流水号。有了MAC地址，就可以定位网卡和数据包的路径了。

+  **广播**

  定义地址只是第一步，后面还有更多的步骤：

  1）首先：一块网卡怎么会知道另一块网卡的MAC地址？

  回答是有一种ARP协议，可以解决这个问题。这个留到后面介绍，这里只需要知道，以太网数据包必须知道接收方的MAC地址，然后才能发送。

  2）其次：就算有了MAC地址，系统怎样才能把数据包准确送到接收方？

  回答是以太网采用了一种很“原始”的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。

  ![](http://www.52im.net/data/attachment/forum/201811/01/150935p07k2g2y6y7k74e0.jpg)

  上图中，1号计算机向2号计算机发送一个数据包，同一个网络的3号、4号、5号计算机都会收到这个包。它们读取这个包的“标头”，找到接收方的MAC地址，然后与自身的MAC地质局相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式叫做"广播"(broadcasting)

  有了数据包的定义、网卡的MAC地址，“链接层”就可以在多台计算机之间传送数据了。

  ​

  ​

#### 网络层

+ 网络层由来

  以太网协议，依靠MAC地址发送数据。理论上，单单依靠MAC地址，上海的网卡就可以找到洛杉矶的网卡了，技术上是可以实现的。

  但是，这样做有一个重大的缺点。以太网采用广播的方式发送数据包，所有成员人手一包，不仅效率低，而且局限在发送者的子网络。也就是说，如果两台计算机所在同一个子网络，广播是传不过去的。这种设计是不合理的，否则互联网上每一台计算机都会收到所有包，会引起灾难。

  互联网风是无数子网络共同组成的一个巨型网络，很难想象上海和洛杉矶的电脑会在同一个子网络，这几乎是不可能的。

  因此，必须找到一种方法，能够却分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络就采用广播方式发送，否则采用“路由”方式发送。("路由"的意思，就是指如何方向不同的子网络发送数据包)遗憾的是，MAC地址本身无法做到这一点。它至于厂商有关，与所处网络无关。

  这就导致了“网络层”的诞生。它的作用是引进一套新的地址，使得我们能够区分不同计算机是否属于同一个子网络。 整套地址就叫做“网络地址”，简称“网址”。

  于是，“网络层”出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种网络地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，他们只是随机组合在一起。

  网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包发送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是线处理网络地址，然后再处理MAC地址。

+ IP协议

  规定网络地址的协议，叫做IP协议。它所定义的地址，就被称为IP地址。目前，广泛采用的是IP协议第四版，简称IPv4。**IPv4这个版本规定，网络地址由32个二进制位组成：**

  ![](http://www.52im.net/data/attachment/forum/201811/01/150947elp4lvaiiesuvlyu.jpg)

  ​

  习惯上，我们用分成四段的十进制数表示IP地址，从0.0.0.0一直到255.255.255.255。

  互联网上的每一台计算机，都会分配到一个IP地址。这个地址分成两部分，前一部分代表网络，后一部分代表主机。比如IP地址172.16.254.1，这是一个32位地址，嘉定它的网络部分是前24位，那么主机部分就是后8位(最后的那个1)。处于同一个子网络的电脑，它们的IP地址的网络部分必定是相同的，也就是说172.16.245.2应该与172.16.245.1处于同一个子网络。

  但是问题在于单单从IP地址，判断两台计算机是否属于同一个子网络呢？这要用到另一个参数"子网掩码"（subnet  mask）。

  所谓’‘子网掩码“，就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.245.1，如果一直网络部分前24位，主机部分是后8位，那么子网掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0。

  知道”子网掩码“，我们就能判断，任意两个IP地址是否处在同一个网络。方法是将两个IP 地址与子网掩码分别进行AND运算，结果都是172.16.254.0，因此它们在同一个子网络。

  总结一下，IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。

+ IP数据包

  根据IP协议发送的数据，就叫做IP数据包。不难想象，其中必定包括IP 地址信息。但前面说过，以太网数据包只包含MAC地址，并没有IP地址的栏位。那么是否需要修改数据定义，在添加一个栏位呢？

  回答是不需要，我们可以把IP数据包直接放进以太网数据包的”数据“部分，，因此完全不用修改以太网的规格。这就是互联网分层结构的好处：上层的变动不涉及下层的结构。

  具体来说，IP数据包也分为”标头“和”数据“两个部分：

  ​

  ![](http://www.52im.net/data/attachment/forum/201811/01/150954xykms5d9vscynnsz.jpg)

  ​

  "标头"部分主要包括版本、长度、IP地址等信息，"数据"部分则是IP数据包的具体内容。它放进以太网数据包后，以太网数据包就变成了下面这样：

  ​

![](http://www.52im.net/data/attachment/forum/201811/01/151007ibebhdrudjqof1qp.jpg)

​	IP数据包的"标头"部分的长度为20到60字节，整个数据包的总长度最大为65,535字节。因此，理论上，一个								IP数据包的"数据"部分，最长为65,515字节。前面说过，以太网数据包的"数据"部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。